<!-- æˆ‘çš„é¡µé¢ -->
<view class="my-page">
    <!-- é¡¶éƒ¨ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
    <view class="user-card">
        <!-- èƒŒæ™¯è£…é¥° -->
        <view class="card-bg"></view>

        <!-- ç”¨æˆ·å¤´åƒå’ŒåŸºæœ¬ä¿¡æ¯ -->
        <view class="user-info-section">
            <!-- å¤´åƒåŒºåŸŸ -->
            <view class="avatar-section" bindtap="">
                <view class="avatar-wrapper">
                    <image class="user-avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill" />
                    <!-- <view class="avatar-edit">
                        <text class="edit-icon">ğŸ“·</text>
                    </view> -->
                </view>
            </view>

            <!-- åŸºæœ¬ä¿¡æ¯ -->
            <view class="basic-info">
                <text class="user-name">{{userInfo.nickName}}</text>

                <!-- éƒ¨é—¨èŒä½ä¿¡æ¯ -->
                <view class="department-info">
                    <text class="user-id">å·¥å·:{{userInfo.employeeNo}}</text>
                    <!--                    <text class="dept-text">{{userInfo.department}}</text>-->
                </view>

                <!-- æ‰‹æœºå· -->
                <view class="phone-section">
                    <text class="phone-icon">ğŸ“±</text>
                    <text class="phone-text">{{userInfo.phoneNumber || 'æœªç»‘å®š'}}</text>
                </view>
            </view>

            <!-- ç¼–è¾‘æŒ‰é’® -->
            <view class="edit-btn" wx:if="{{userInfo.userId}}" bindtap="toEdit">
                <text class="edit-text">ç¼–è¾‘</text>
            </view>
            <view class="edit-btn" wx:if="{{!userInfo.userId}}" bindtap="toLogin">
                <text class="edit-text">ç™»å½•</text>
            </view>
        </view>

        <!-- å·¥ä½œç»Ÿè®¡ -->
        <view class="work-statistics">
            <view class="stat-item">
                <text class="stat-number">{{statistics.totalTasks}}</text>
                <text class="stat-label">æ€»ä»»åŠ¡</text>
            </view>
            <view class="stat-divider"></view>
            <view class="stat-item">
                <text class="stat-number">{{statistics.completedTasks}}</text>
                <text class="stat-label">å·²å®Œæˆ</text>
            </view>
            <view class="stat-divider"></view>
            <view class="stat-item">
                <text class="stat-number">{{statistics.pendingTasks}}</text>
                <text class="stat-label">è¿›è¡Œä¸­</text>
            </view>
        </view>
    </view>

    <!-- åŠŸèƒ½èœå• -->
    <view class="menu-section">
        <view class="section-title">
            <text class="title-text">å¸¸ç”¨åŠŸèƒ½</text>
        </view>

        <view class="menu-grid">
            <view class="menu-item" wx:for="{{menuItems}}" wx:key="id" bindtap="onMenuItemClick" data-id="{{item.id}}">
                <view class="menu-icon">
                    <text class="icon-text">{{item.icon}}</text>
                </view>
                <view class="menu-content">
                    <text class="menu-title">{{item.title}}</text>
                    <text class="menu-subtitle">{{item.subTitle}}</text>
                </view>
                <view class="menu-arrow">
                    <text class="arrow-icon">â€º</text>
                </view>
            </view>
        </view>
    </view>

    <!-- ç³»ç»Ÿè®¾ç½®åŒºåŸŸ -->
    <view class="system-section">
        <view class="section-title">
            <text class="title-text">ç³»ç»Ÿè®¾ç½®</text>
        </view>

        <view class="system-list">
            <!-- æ£€æŸ¥æ›´æ–° -->
            <view class="system-item" bindtap="checkUpdate">
                <view class="item-left">
                    <text class="item-icon">ğŸ”„</text>
                    <text class="item-title">æ£€æŸ¥æ›´æ–°</text>
                </view>
                <view class="item-right">
                    <text class="version-text">v{{appVersion}}</text>
                    <text class="arrow-icon">â€º</text>
                </view>
            </view>

            <!-- å…³äºæˆ‘ä»¬ -->
            <view class="system-item" bindtap="aboutUs">
                <view class="item-left">
                    <text class="item-icon">â„¹ï¸</text>
                    <text class="item-title">å…³äºæˆ‘ä»¬</text>
                </view>
                <view class="item-right">
                    <text class="arrow-icon">â€º</text>
                </view>
            </view>

            <!-- è”ç³»å®¢æœ -->
            <view class="system-item" bindtap="contactCustomerService">
                <view class="item-left">
                    <text class="item-icon">ğŸ“</text>
                    <text class="item-title">è”ç³»å®¢æœ</text>
                </view>
                <view class="item-right">
                    <text class="phone-call">189157555120</text>
                    <text class="arrow-icon">â€º</text>
                </view>
            </view>

            <!-- æœ€åç™»å½•æ—¶é—´ -->
            <view class="system-item">
                <view class="item-left">
                    <text class="item-icon">â°</text>
                    <text class="item-title">æœ€åç™»å½•</text>
                </view>
                <view class="item-right">
                    <text class="login-time">{{lastLoginTime}}</text>
                </view>
            </view>
        </view>
    </view>

    <!-- é€€å‡ºç™»å½•æŒ‰é’® -->
    <view class="logout-section" wx:if="{{userInfo.userId}}">
        <button class="logout-btn" type="primary" bindtap="logout">
            <text class="logout-icon">ğŸšª</text>
            <text class="logout-text">é€€å‡ºç™»å½•</text>
        </button>
    </view>

    <!-- åº•éƒ¨ç‰ˆæƒä¿¡æ¯ -->
    <view class="footer">
        <text class="copyright">Â© 2025 ç”Ÿäº§ç®¡ç†ç³»ç»Ÿ</text>
        <text class="slogan">è®©ç”Ÿäº§æ›´æ™ºèƒ½</text>
    </view>
</view>


<!-- ç™»å½•å¼¹çª— -->
<view class="modal-overlay" wx:if="{{showLoginModal}}" bindtap="">
    <view class="add-modal" catchtap="">
        <view class="modal-header">
            <text class="modal-title">ç™»å½•</text>
            <text class="close-btn" bindtap="closeLoginModal">Ã—</text>
        </view>

        <view class="modal-content">
            <view class="form-item">
                <text class="form-label">æ‰‹æœºå·/å·¥å·ï¼š</text>
                <input class="form-input" placeholder="è¯·è¾“å…¥æ‰‹æœºå·/å·¥å·" value="{{phoneOrNo}}" data-field="phoneOrNo"
                    bindinput="onFormInput" />
            </view>
        </view>
        <view class="modal-actions">
            <button class="action-btn cancel-btn" bindtap="closeLoginModal">å–æ¶ˆ</button>
            <button class="action-btn save-btn" bindtap="checkUser">ç™»å½•</button>
        </view>
    </view>
</view>

<!-- ç¼–è¾‘å¼¹çª— -->
<view class="modal-overlay" wx:if="{{showEditModal}}" bindtap="">
    <view class="add-modal" catchtap="">
        <view class="modal-header">
            <text class="modal-title">ç¼–è¾‘</text>
            <text class="close-btn" bindtap="closeEditModal">Ã—</text>
        </view>
        <view class="modal-content">
            <view class="form-item">
                <button class="btn" open-type="chooseAvatar" bindchooseavatar="choosePhoto">
                    <image src="{{editAvatarUrl}}" class="photo" />
                </button>
            </view>
            <view class="form-item">
                <text class="form-label">æ˜µç§°ï¼š</text>
                <input class="input" type="nickname" placeholder="è¾“å…¥æˆ–è·å–æ˜µç§°" model:value="{{userInfo.nickName}}" 
                bindinput="onFormInput" data-field="editName"/>
            </view>
            <view class="form-item">
                <text class="form-label">æ‰‹æœºå·ï¼š</text>
                <input class="form-input" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" value="{{userInfo.phoneNumber}}" data-field="editPhone"
                    bindinput="onFormInput" />
            </view>
        </view>
        <view class="modal-actions">
            <button class="action-btn cancel-btn" bindtap="closeEditModal">å–æ¶ˆ</button>
            <button class="action-btn save-btn" bindtap="updateUser">ä¿å­˜</button>
        </view>
    </view>
</view>